{"version":3,"file":"authMiddleware.js","names":["_jsonwebtoken","_interopRequireDefault","require","_authService","_index","isLoggedIn","_ref","_asyncToGenerator2","_regenerator","mark","_callee","req","res","next","token","decodedData","currentUser","userObj","wrap","_callee$","_context","prev","headers","authorization","split","jwt","verify","concat","process","env","JWT_SECRET","findOneUserService","payload","id","sent","console","log","email","status","json","success","message","user","t0","stop","_x","_x2","_x3","apply","arguments","isSeller","_ref2","_callee2","_callee2$","_context2","role","_x4","_x5","_x6","exports","checkUserExists","_ref3","_callee3","userInDb","_callee3$","_context3","body","User","findOne","where","abrupt","_x7","_x8","_x9","_default"],"sources":["../../src/middleware/authMiddleware.js"],"sourcesContent":["// eslint-disable-next-line import/no-extraneous-dependencies\nimport jwt from 'jsonwebtoken';\nimport findOneUserService from '../services/authService';\nimport { User } from '../database/models/index';\n\nconst isLoggedIn = async (req, res, next) => {\n  if (req.headers.authorization) {\n    const token = req.headers.authorization.split(\" \")[1];\n    try {\n      const decodedData = jwt.verify(token, `${process.env.JWT_SECRET}`);\n\n      const currentUser = await findOneUserService(decodedData.payload.id);\n      console.log(currentUser);\n      const userObj = {\n        id: currentUser.id,\n        email: currentUser.email,\n      };\n      if (!currentUser) {\n        res.status(401).json({\n          status: 401,\n          success: false,\n          message: \"User does not exist!\",\n        });\n      } else {\n        req.user = userObj;\n        next();\n      }\n    } catch (error) {\n      res.status(500).json({\n        status: 500,\n        success: false,\n        message: `Error when authorizing user ${error.message}`,\n      });\n    }\n  } else {\n    res.status(401).json({\n      status: 401,\n      success: false,\n      message: \"Not logged in\",\n    });\n  }\n};\n\nexport const isSeller = async (req, res, next) => {\n  try {\n    const token = req.headers.authorization.split(\" \")[1];\n\n    const decodedData = jwt.verify(token, `${process.env.JWT_SECRET}`);\n\n    const currentUser = await findOneUserService(decodedData.payload.id);\n    console.log(currentUser.role);\n    if (currentUser.role === \"seller\") {\n      next();\n    } else {\n      res.status(401).json({\n        status: 401,\n        success: false,\n        message: \"User is not a seller\",\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      status: 500,\n      success: false,\n      message: `Error when authorizing user ${error.message}`,\n    });\n  }\n};\nexport const checkUserExists = async (req, res, next) => {\n  const { email } = req.body;\n  const userInDb = await User.findOne({\n    where: { email },\n  });\n  if (userInDb) {\n    return res.status(409).json({ message: 'Email already exists' });\n  }\n  next();\n};\nexport default isLoggedIn;\n"],"mappings":"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"}