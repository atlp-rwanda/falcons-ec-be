{"version":3,"file":"passport.js","names":["dotenv","_interopRequireWildcard","require","_bcrypt","_interopRequireDefault","_passport","_passportGoogleOauth","_index","_token_generator","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","User","db","config","GOOGLE_CLIENT_ID","process","env","GOOGLE_CLIENT_SECRET","passport","use","GoogleStrategy","clientID","clientSecret","callbackURL","concat","URL","passReqToCallback","_ref","_asyncToGenerator2","_regenerator","mark","_callee","request","accessToken","refreshToken","profile","done","given_name","googleUser","TOKEN","userObject","user","wrap","_callee$","_context","prev","next","findOne","where","email","sent","name","token","generateToken","console","log","t0","t1","t2","BcryptUtil","hash","t3","t4","password","create","save","t5","message","stop","_x","_x2","_x3","_x4","_x5","apply","arguments","serializeUser","deserializeUser"],"sources":["../../src/config/passport.js"],"sourcesContent":["import * as dotenv from 'dotenv';\r\nimport BcryptUtil from 'bcrypt';\r\nimport passport from 'passport';\r\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth2';\r\nimport db from '../database/models/index';\r\nimport generateToken from '../helpers/token_generator';\r\n\r\nconst { User } = db;\r\n\r\ndotenv.config();\r\nconst { GOOGLE_CLIENT_ID } = process.env;\r\nconst { GOOGLE_CLIENT_SECRET } = process.env;\r\npassport.use(\r\n  new GoogleStrategy(\r\n    {\r\n      clientID: GOOGLE_CLIENT_ID,\r\n      clientSecret: GOOGLE_CLIENT_SECRET,\r\n      callbackURL: `${process.env.URL}/google/callback`,\r\n      passReqToCallback: true,\r\n    },\r\n    async (request, accessToken, refreshToken, profile, done) => {\r\n      try {\r\n        // eslint-disable-next-line camelcase\r\n        const { given_name } = profile;\r\n        const googleUser = await User.findOne({\r\n          where: { email: [profile.email] },\r\n        });\r\n        let TOKEN;\r\n        const userObject = {\r\n          // eslint-disable-next-line camelcase\r\n          name: given_name,\r\n          email: profile.email,\r\n          token: TOKEN,\r\n        };\r\n\r\n        if (googleUser) {\r\n          TOKEN = generateToken(userObject);\r\n          console.log('The user is saved in our db!!!!!!');\r\n          console.log(TOKEN);\r\n          done(null, profile);\r\n        }\r\n         else {\r\n          const user = await User.create({\r\n            // eslint-disable-next-line camelcase\r\n            name: given_name,\r\n            email: profile.email,\r\n            password: await BcryptUtil.hash('password', 10),\r\n          });\r\n          user.save();\r\n          TOKEN = generateToken(user);\r\n          console.log('The user is saved in our db!!!!!!');\r\n          console.log(TOKEN);\r\n          done(null, profile);\r\n        }\r\n      } catch (error) {\r\n        console.log(error.message);\r\n      }\r\n    },\r\n  ),\r\n);\r\n\r\npassport.serializeUser((user, done) => {\r\n  done(null, user);\r\n});\r\n\r\npassport.deserializeUser((user, done) => {\r\n  done(null, user);\r\n});\r\n"],"mappings":"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"}